+++
categories = ["2v0-621"]
tags = ["2v0-621"]
description = ""
slug = "2v0-621-7"
draft = false
title = "2v0-621_Section7"
date = 2016-09-21T18:43:13Z
author = "Alibaba"

+++

# Troubleshoot a vSphere Deployment
1. 內容程式庫的直接父系為全域根物件。
2. 當Content library 被刪除之後,後端Storage 也會被刪除。
3. 如果在安裝 vCenter Server、Inventory Service 或 Web client 的過程中遇到有關 vCenter SSO 的問題，請執行以下步驟：
 - 確保 vCenter SSO 服務器與 Active Directory 域控制器之間存在時差。如果時差超過 5 分鐘，Kerboros 身份驗證會失敗
 - 驗證 SSO 服務器的配置
 - 驗證每個域控制器在 DNS 中是否均有正確配置的 PTR 記錄，並確保 PTR 記錄的內容準確。要從 Windows 命令行對此進行檢查，可對名稱和 IP 運行 nslookup 命令
 - 如果在域控制器中啟用了 SSL，請確認 SSL 證書仍然有效。
 - 移除 vCenter SSO 主機，然後將其重新加入到域中。這樣，如果在向域添加的過程中出現故障，便可發現任何連接或基於信任的錯誤
 - 安裝完成後，查看 install.log 和 imsTrace.log 文件 SSO_Server_Directory\utils\logs\，以瞭解是否在自動發現過程中出現錯誤。 
4. 假若在vCenter Server 無法看到 上週 Performance 統計資訊的原因
 - Performance statistics are turned off
 - The Past Day rollup job is not present.
 - The stats_rollup_1_proc is not present 
5. 當 ESXi 5.1/5.5 主機由 vCenter Server 5.1 和 5.5 進行管理時，將安裝兩個組件，每個組件都有自己的日誌[ESXi 5.1 和 5.5 日誌文件的位置 (2095394) ](https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2095394)
 - /var/log/vpxa.log：vCenter Server vpxa 代理日誌，包括與 vCenter Server 和主機管理 hostd 代理之間的通信。
 - /var/log/fdm.log：vSphere High Availability 日誌，由 fdm 服務生成。
6. 虛擬機已意外關閉,可以看以下兩個Log[確定虛擬機關閉電源或重新啟動的原因 (2078043) ](https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2078043)
 - vmware.log
 - hostd.log
7. 在 vSphere Web Client 中有**孤立(orphaned)**的虛擬機,發生原因如下:[在 vSphere Web Client 中恢復孤立的虛擬機](https://pubs.vmware.com/vsphere-50/index.jsp#com.vmware.vsphere.troubleshooting.doc_50/GUID-BFD8C9BC-30FB-4A92-AFEC-2FC9FF387920.html)
 - 主機故障切換失敗
 - 直接在主機上取消對虛擬機的註冊時

8. 無法開啟VirtualMachine [無法打開虛擬機電源](https://pubs.vmware.com/vsphere-50/index.jsp?topic=%2Fcom.vmware.vsphere.troubleshooting.doc_50%2FGUID-D4770546-9F9A-4F1E-AC1C-CF313E6130F4.html)
 - The virtual machine is running on an ESXi host which has an expired license.
 - The virtual machine is running on a datastore which has insufficient disk space for the .vswp file
 - The virtual machine is in a cluster with vSphere HA Admission control enabled

9. 哪個指令可以檢驗 VMFS3 and VMFS5 Datastore for metadata inconsistency(metadata 一致性) [參考check VMFS ](http://www.running-system.com/how-to-check-vmfs-for-metadata-corruption-esxi-5-1-and-later/)
 - voma(Vmware Ondisk Metadata Analyser)

10. 哪兩個原因造成 VirtualSAN 無法用 local flash device
 - It has a VMFS datastore present.
 - It is in use by the vFlash Read Cache feature.
11. 對於配置Virtual Machine template造成 slow Performance,以下三項動作來改善它
 - Increase network throughput by adding additional uplinks to the vSwitch.
 - Change the destination datastore or volume for the virtual machine template.
 - Configure a Provisioning Traffic vmkernel port to perform the deployment operation.
12. 無法從分散式交換器中移除主機或刪除主機代理交換器，原因如下。 [無法從 vSphere Distributed Switch 中移除主機](https://pubs.vmware.com/vsphere-55/index.jsp?topic=%2Fcom.vmware.vsphere.troubleshooting.doc%2FGUID-038AC93F-D710-48ED-8E3B-258A23FB2930.html)
 - 使用中的交換器上有 VMkernel 介面卡。
 - 有連線到交換器的虛擬機器網路介面卡。 

13. IF the NFS datastore is showing 0 bytes of capacity when you use **df -h** command, it means that the NFS server that hosts datastore is down.
14. vCenter server Appliance 5 要升級到  6 的版本,需間接升級。
 - 5.0 -> 5.1 update 3 -> vcenter 6.0
15. 調查 vCenter Server upgrade 發生的錯誤訊息,可以用以下三個 Log 來調查
 - vminst.log
 - vim-vcs-msi.log
 - pkgmgr.log
16. 利用 esxtop 分析 CPU 情況,以下哪三個指標顯示 CPU 爭奪[參考解讀CPU統計值_英文](https://communities.vmware.com/docs/DOC-9279)
 - %RDY  (Ready Time: 說明vCPU 要等候多久才有可用的LCPU)
 - %RUN
 - %MLMTD  
17. 在VM 設定檔中設定 CPU Performance 
 - numa.vcpu.preferHT=TRUE
18. 要使用vNUMA 功能需更新 Virtual Hardware version 8

19. 通常 %RDY > 10% 情況:
 - % RDY 約等於 %USED  表示 OK
 - % RDY 與 %USED 相差太多 表示 不 OK
20. VMware FT 是保護 Host零停機。
21. Fault Tolerance is not licensed in all editions of VMware vSphere. Check the edition you are running and upgrade to an edition that includes Fault Tolerance.
22. 數據存儲群集中的數據存儲無法進入維護模式。「正在進入維護模式」狀態保持為 1%,造成此原因如下:
 - Storage DRS is disabled on the disk.
 - Storage DRS rules prevent Storage DRS from making migration recommendations for the disk.
23. 以下是SDRS負載不平衡的可能原因：
 - The migration threshold is too high.(遷移閾值過高。)
 - VM/VM or VM/Host DRS rules prevent virtual machines from being moved.(虛擬機/虛擬機或虛擬機/主機 DRS 規則可阻止移動虛擬機。)
 - DRS is disabled for one or more virtual machines.(
為一個或多個虛擬機禁用了 DRS。)
 - A device is mounted to one or more virtual machines preventing DRS from moving the virtual machine in order to balance the load.(擬機與 DRS 要將它們移動到的主機不兼容。這就是說，群集中至少有一個主機與將要遷移的虛擬機不兼容。例如，如果主機 A 的 CPU 不與主機 B 的 CPU vMotion 兼容，則主機 A 將與在主機 B 上運行的已打開電源虛擬機變得不兼容。)
 - Virtual machines are not compatible with the hosts to which DRS would move them. That is, at least one of the hosts in the cluster is incompatible for the virtual machines that would be migrated. For example, if host A's CPU is not vMotion-compatible with host B's CPU, then host A becomes incompatible for powered-on virtual machines running on host B.(虛擬機與 DRS 要將它們移動到的主機不兼容。這就是說，群集中至少有一個主機與將要遷移的虛擬機不兼容。例如，如果主機 A 的 CPU 不與主機 B 的 CPU vMotion 兼容，則主機 A 將與在主機 B 上運行的已打開電源虛擬機變得不兼容)
 - It would be more detrimental for the virtual machine's performance to move it than for it to run where it is currently located. This may occur when loads are unstable or the migration cost is high compared to the benefit gained from moving the virtual machine.(與虛擬機保留在當前位置繼續運行相比，移動虛擬機可能會對其性能更加不利。當負載不穩定或者遷移成本比移動虛擬機所帶來的收益要高時，就會出現上述情況。)
 - vMotion is not enabled or set up for the hosts in the cluster.(沒有為群集中的主機啟用或設置 vMotion。)
24. 如果在共享存儲中沒有允許數據存儲檢測信號的冗餘，則會發生此問題。 自 vSphere 5.0 開始，vSphere HA 至少需要在群集中的所有主機之間共享兩個共享數據存儲，才能正常運行數據存儲檢測信號。